<div class="register-page">
  <div class="register-card">
    <div class="register-header">
      <div class="logo">ğŸ </div>
      <h1>PAC DormConnect</h1>
      <p>Parent/Guardian Registration</p>
    </div>

    @if (registrationComplete()) {
      <!-- Success state - only show this when registration is complete -->
      <div class="registration-success">
        <div class="success-icon">âœ“</div>
        <h2>Registration Submitted!</h2>
        <p class="success-message">
          Your account is pending admin approval. You will be notified once your registration has been reviewed.
        </p>
        <div class="success-info">
          <div class="info-item">
            <span class="info-icon">ğŸ“§</span>
            <span>Check your email for updates</span>
          </div>
          <div class="info-item">
            <span class="info-icon">â±ï¸</span>
            <span>Approval typically takes 1-2 business days</span>
          </div>
        </div>
        <a routerLink="/login" class="btn-back-to-login">
          <span>â†</span> Back to Login
        </a>
      </div>
    } @else {
      <!-- Registration form -->
      @if (errorMessage()) {
        <div class="alert alert-error">
          <span class="alert-icon">âš ï¸</span>
          {{ errorMessage() }}
        </div>
      }

    <form (ngSubmit)="onSubmit()" class="register-form">
      <div class="form-row">
        <div class="form-group" [class.has-error]="fieldErrors().firstName">
          <label for="firstName">First Name *</label>
          <div class="input-wrapper">
            <span class="input-icon">ğŸ‘¤</span>
            <input 
              type="text" 
              id="firstName" 
              placeholder="Enter your first name"
              [(ngModel)]="form.firstName"
              name="firstName"
              (input)="clearFieldError('firstName')"
              autocomplete="given-name"
            />
          </div>
          @if (fieldErrors().firstName) {
            <span class="field-error">{{ fieldErrors().firstName }}</span>
          }
        </div>

        <div class="form-group" [class.has-error]="fieldErrors().lastName">
          <label for="lastName">Last Name *</label>
          <div class="input-wrapper">
            <span class="input-icon">ğŸ‘¤</span>
            <input 
              type="text" 
              id="lastName" 
              placeholder="Enter your last name"
              [(ngModel)]="form.lastName"
              name="lastName"
              (input)="clearFieldError('lastName')"
              autocomplete="family-name"
            />
          </div>
          @if (fieldErrors().lastName) {
            <span class="field-error">{{ fieldErrors().lastName }}</span>
          }
        </div>
      </div>

      <div class="form-group" [class.has-error]="fieldErrors().email">
        <label for="email">Email Address *</label>
        <div class="input-wrapper">
          <span class="input-icon">ğŸ“§</span>
          <input 
            type="email" 
            id="email" 
            placeholder="Enter your email"
            [(ngModel)]="form.email"
            name="email"
            (input)="clearFieldError('email')"
            autocomplete="email"
          />
        </div>
        @if (fieldErrors().email) {
          <span class="field-error">{{ fieldErrors().email }}</span>
        }
      </div>

      <div class="form-group" [class.has-error]="fieldErrors().phone">
        <label for="phone">Phone Number *</label>
        <div class="input-wrapper">
          <span class="input-icon">ğŸ“±</span>
          <input 
            type="tel" 
            id="phone" 
            placeholder="e.g., 09171234567"
            [(ngModel)]="form.phone"
            name="phone"
            (input)="clearFieldError('phone')"
            autocomplete="tel"
          />
        </div>
        @if (fieldErrors().phone) {
          <span class="field-error">{{ fieldErrors().phone }}</span>
        }
      </div>

      <div class="form-group" [class.has-error]="fieldErrors().studentResidentId">
        <label for="studentResidentId">Student Resident ID *</label>
        <div class="input-wrapper">
          <span class="input-icon">ğŸ†”</span>
          <input 
            type="text" 
            id="studentResidentId" 
            placeholder="e.g., PAC-ABC123"
            [(ngModel)]="form.studentResidentId"
            name="studentResidentId"
            (input)="clearFieldError('studentResidentId')"
            style="text-transform: uppercase;"
          />
        </div>
        <p class="field-hint">Enter your child's Student Resident ID (provided upon their registration)</p>
        @if (fieldErrors().studentResidentId) {
          <span class="field-error">{{ fieldErrors().studentResidentId }}</span>
        }
      </div>

      <!-- Face capture section -->
      <div class="form-group face-capture-group" [class.has-error]="fieldErrors().faceImage">
        <label>Face Capture for Verification *</label>
        <p class="face-capture-hint">Your face will be used to verify your identity when approving leave requests.</p>
        
        @if (cameraError()) {
          <div class="camera-error">
            <span>âš ï¸</span> {{ cameraError() }}
          </div>
        }

        <div class="face-capture-container">
          @if (!cameraActive() && !faceImageCaptured()) {
            <!-- Initial state: Show start camera button -->
            <div class="face-capture-placeholder">
              <span class="placeholder-icon">ğŸ“·</span>
              <p>Click below to start the camera and capture your face</p>
              <button type="button" class="btn-camera" (click)="startCamera()">
                <span>ğŸ“¸</span> Start Camera
              </button>
            </div>
          }

          @if (cameraActive()) {
            <!-- Camera active: Show video feed -->
            <div class="camera-preview">
              <div class="video-container">
                <video 
                  #videoElement 
                  autoplay 
                  playsinline
                  class="camera-video"
                ></video>
                <div class="face-frame-overlay" [class.face-detected]="faceDetected()">
                  <div class="face-frame"></div>
                  @if (autoCapturing() && countdown() > 0) {
                    <div class="countdown-display">{{ countdown() }}</div>
                  }
                  @if (!faceDetected()) {
                    <span class="frame-hint">Position your face within the frame</span>
                  } @else if (!autoCapturing()) {
                    <span class="frame-hint detecting">Detecting face...</span>
                  } @else {
                    <span class="frame-hint ready">Hold steady - capturing in {{ countdown() }}...</span>
                  }
                </div>
              </div>
              <canvas #canvasElement style="display: none;"></canvas>
              <div class="camera-controls">
                @if (isValidatingFace()) {
                  <button type="button" class="btn-capture" disabled>
                    <span class="spinner-small"></span> Validating...
                  </button>
                } @else if (autoCapturing()) {
                  <button type="button" class="btn-capture capturing" disabled>
                    <span class="spinner-small"></span> Auto-capturing...
                  </button>
                } @else {
                  <button type="button" class="btn-capture" (click)="capturePhoto()">
                    <span>ğŸ“¸</span> Capture Manually
                  </button>
                }
                <button type="button" class="btn-cancel-camera" (click)="stopCamera()" [disabled]="isValidatingFace()">
                  Cancel
                </button>
              </div>
            </div>
          }

          @if (faceImageCaptured()) {
            <!-- Photo captured: Show preview -->
            <div class="captured-preview">
              <img [src]="faceImageCaptured()" alt="Captured face" class="captured-image" />
              <div class="captured-controls">
                <span class="capture-success">âœ“ Face captured successfully</span>
                <button type="button" class="btn-retake" (click)="retakePhoto()">
                  <span>ğŸ”„</span> Retake
                </button>
              </div>
            </div>
          }
        </div>
        
        @if (fieldErrors().faceImage) {
          <span class="field-error">{{ fieldErrors().faceImage }}</span>
        }
      </div>

      <div class="form-group" [class.has-error]="fieldErrors().password">
        <label for="password">Password *</label>
        <div class="input-wrapper">
          <span class="input-icon">ğŸ”’</span>
          <input 
            [type]="showPassword() ? 'text' : 'password'"
            id="password" 
            placeholder="Create a password (min 6 characters)"
            [(ngModel)]="form.password"
            name="password"
            (input)="clearFieldError('password')"
            autocomplete="new-password"
          />
          <button 
            type="button" 
            class="toggle-password"
            (click)="togglePasswordVisibility()"
          >
            {{ showPassword() ? 'ğŸ™ˆ' : 'ğŸ‘ï¸' }}
          </button>
        </div>
        @if (fieldErrors().password) {
          <span class="field-error">{{ fieldErrors().password }}</span>
        }
      </div>

      <div class="form-group" [class.has-error]="fieldErrors().confirmPassword">
        <label for="confirmPassword">Confirm Password *</label>
        <div class="input-wrapper">
          <span class="input-icon">ğŸ”’</span>
          <input 
            [type]="showConfirmPassword() ? 'text' : 'password'"
            id="confirmPassword" 
            placeholder="Confirm your password"
            [(ngModel)]="form.confirmPassword"
            name="confirmPassword"
            (input)="clearFieldError('confirmPassword')"
            autocomplete="new-password"
          />
          <button 
            type="button" 
            class="toggle-password"
            (click)="toggleConfirmPasswordVisibility()"
          >
            {{ showConfirmPassword() ? 'ğŸ™ˆ' : 'ğŸ‘ï¸' }}
          </button>
        </div>
        @if (fieldErrors().confirmPassword) {
          <span class="field-error">{{ fieldErrors().confirmPassword }}</span>
        }
      </div>

      <button 
        type="submit" 
        class="btn-register"
        [disabled]="isLoading()"
      >
        @if (isLoading()) {
          <span class="spinner"></span>
          Creating Account...
        } @else {
          Create Account
        }
      </button>
    </form>

    <div class="register-footer">
      <p><a routerLink="/register">â† Change account type</a></p>
      <p>Already have an account? <a routerLink="/login">Sign In</a></p>
    </div>
    }
  </div>
</div>
