<div class="go-out-request">
  <div class="page-header">
    <button class="back-btn" (click)="goBack()">
      <span class="back-icon">‚Üê</span>
      Back
    </button>
    <div class="header-content">
      <h1>Request to Go Out</h1>
      <p>Submit your request to leave campus. Your request will be reviewed by the admin/dean and your parent.</p>
    </div>
  </div>

  @if (errorMessage()) {
    <div class="alert alert-error">
      <span class="alert-icon">‚ö†Ô∏è</span>
      {{ errorMessage() }}
    </div>
  }

  @if (successMessage()) {
    <div class="alert alert-success">
      <span class="alert-icon">‚úì</span>
      {{ successMessage() }}
    </div>
  }

  <form (ngSubmit)="onSubmit()" class="request-form">
    <!-- Leave Type -->
    <div class="form-section">
      <h3>Type of Leave</h3>
      <div class="leave-types">
        @for (type of leaveTypes; track type.value) {
          <label class="type-option" [class.selected]="form.leaveType === type.value">
            <input 
              type="radio" 
              name="leaveType" 
              [value]="type.value" 
              [(ngModel)]="form.leaveType"
            />
            <div class="type-content">
              <span class="type-label">{{ type.label }}</span>
              <span class="type-desc">{{ type.description }}</span>
            </div>
          </label>
        }
      </div>
    </div>

    <!-- Date & Time -->
    <div class="form-section">
      <h3>Schedule</h3>
      <div class="date-time-grid">
        <div class="form-group" [class.has-error]="fieldErrors().startDate">
          <label for="startDate">Departure Date *</label>
          <input 
            type="date" 
            id="startDate" 
            [(ngModel)]="form.startDate" 
            name="startDate"
            [min]="getTodayDate()"
            (input)="clearFieldError('startDate')"
            required
          />
          @if (fieldErrors().startDate) {
            <span class="field-error">{{ fieldErrors().startDate }}</span>
          }
        </div>
        <div class="form-group" [class.has-error]="fieldErrors().startTime">
          <label for="startTime">Departure Time *</label>
          <input 
            type="time" 
            id="startTime" 
            [(ngModel)]="form.startTime" 
            name="startTime"
            [min]="getMinStartTime()"
            (input)="clearFieldError('startTime')"
            required
          />
          @if (fieldErrors().startTime) {
            <span class="field-error">{{ fieldErrors().startTime }}</span>
          }
        </div>
        <div class="form-group" [class.has-error]="fieldErrors().endDate">
          <label for="endDate">Return Date *</label>
          <input 
            type="date" 
            id="endDate" 
            [(ngModel)]="form.endDate" 
            name="endDate"
            [min]="getMinEndDate()"
            (input)="clearFieldError('endDate')"
            required
          />
          @if (fieldErrors().endDate) {
            <span class="field-error">{{ fieldErrors().endDate }}</span>
          }
        </div>
        <div class="form-group" [class.has-error]="fieldErrors().endTime">
          <label for="endTime">Return Time *</label>
          <input 
            type="time" 
            id="endTime" 
            [(ngModel)]="form.endTime" 
            name="endTime"
            (input)="clearFieldError('endTime')"
            required
          />
          @if (fieldErrors().endTime) {
            <span class="field-error">{{ fieldErrors().endTime }}</span>
          }
        </div>
      </div>
    </div>

    <!-- Destination & Reason -->
    <div class="form-section">
      <h3>Details</h3>
      <div class="form-group" [class.has-error]="fieldErrors().destination">
        <label for="destination">Destination *</label>
        <input 
          type="text" 
          id="destination" 
          [(ngModel)]="form.destination" 
          name="destination"
          placeholder="Where are you going? (e.g., Mall of Asia, Home - Quezon City)"
          (input)="clearFieldError('destination')"
          required
        />
        @if (fieldErrors().destination) {
          <span class="field-error">{{ fieldErrors().destination }}</span>
        }
      </div>
      <div class="form-group" [class.has-error]="fieldErrors().reason">
        <label for="reason">Reason for Leave *</label>
        <textarea 
          id="reason" 
          [(ngModel)]="form.reason" 
          name="reason"
          rows="4"
          placeholder="Please provide a detailed reason for your request..."
          (input)="clearFieldError('reason')"
          required
        ></textarea>
        @if (fieldErrors().reason) {
          <span class="field-error">{{ fieldErrors().reason }}</span>
        }
      </div>
    </div>

    <!-- Emergency Contact -->
    <div class="form-section">
      <h3>Emergency Contact</h3>
      <p class="section-note">Person to contact in case of emergency while you're away</p>
      <div class="contact-grid">
        <div class="form-group" [class.has-error]="fieldErrors().emergencyContact">
          <label for="emergencyContact">Contact Name *</label>
          <input 
            type="text" 
            id="emergencyContact" 
            [(ngModel)]="form.emergencyContact" 
            name="emergencyContact"
            placeholder="Full name of emergency contact"
            (input)="clearFieldError('emergencyContact')"
            required
          />
          @if (fieldErrors().emergencyContact) {
            <span class="field-error">{{ fieldErrors().emergencyContact }}</span>
          }
        </div>
        <div class="form-group" [class.has-error]="fieldErrors().emergencyPhone">
          <label for="emergencyPhone">Contact Phone *</label>
          <input 
            type="tel" 
            id="emergencyPhone" 
            [(ngModel)]="form.emergencyPhone" 
            name="emergencyPhone"
            placeholder="e.g., 09171234567"
            (input)="clearFieldError('emergencyPhone')"
            required
          />
          @if (fieldErrors().emergencyPhone) {
            <span class="field-error">{{ fieldErrors().emergencyPhone }}</span>
          }
        </div>
      </div>
    </div>

    <!-- Approval Process Info -->
    <div class="info-box">
      <h4>üìã Approval Process</h4>
      <ol>
        <li><strong>Admin/Dean Review:</strong> Your request will first be reviewed by the dormitory admin or dean.</li>
        <li><strong>Parent Approval:</strong> Once admin approves, your parent/guardian will be notified to approve.</li>
        <li><strong>QR Code Generated:</strong> After both approvals, a QR code will be generated for you.</li>
        <li><strong>Security Scan:</strong> Show your QR code to the security guard when leaving and returning.</li>
      </ol>
    </div>

    <!-- Submit Button -->
    <div class="form-actions">
      <button type="button" class="btn-secondary" (click)="goBack()">Cancel</button>
      <button 
        type="submit" 
        class="btn-primary" 
        [disabled]="!isFormValid() || isSubmitting()"
      >
        @if (isSubmitting()) {
          <span class="spinner"></span>
          Submitting...
        } @else {
          Submit Request
        }
      </button>
    </div>
  </form>
</div>
