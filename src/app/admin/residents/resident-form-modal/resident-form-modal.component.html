<div class="modal-overlay" (click)="close.emit()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <button class="modal-close" (click)="close.emit()">âœ•</button>
    
    <div class="modal-header">
      <h2>{{ mode === 'add' ? 'Add New Resident' : 'Edit Resident' }}</h2>
    </div>

    <div class="modal-body">
      @if (errorMessage || localError()) {
        <div class="alert alert-error">{{ errorMessage || localError() }}</div>
      }

      @if (mode === 'add') {
        <div class="form-group">
          <label for="email">Email <span class="required">*</span></label>
          <input 
            type="email" 
            id="email" 
            [value]="formData().email"
            (input)="updateField('email', $event)"
            placeholder="resident@email.com"
          />
        </div>

        <div class="form-group">
          <label for="password">Password <span class="required">*</span></label>
          <input 
            type="password" 
            id="password"
            [value]="formData().password"
            (input)="updateField('password', $event)"
            placeholder="Enter password"
          />
        </div>
      } @else {
        <div class="form-group">
          <label>Email</label>
          <input 
            type="email" 
            [value]="formData().email"
            disabled
          />
        </div>
      }

      <div class="form-row">
        <div class="form-group">
          <label for="firstName">First Name <span class="required">*</span></label>
          <input 
            type="text" 
            id="firstName"
            [value]="formData().firstName"
            (input)="updateField('firstName', $event)"
            placeholder="John"
          />
        </div>
        <div class="form-group">
          <label for="lastName">Last Name <span class="required">*</span></label>
          <input 
            type="text" 
            id="lastName"
            [value]="formData().lastName"
            (input)="updateField('lastName', $event)"
            placeholder="Doe"
          />
        </div>
      </div>

      <div class="form-group">
        <label for="phone">Phone</label>
        <input 
          type="tel" 
          id="phone"
          [value]="formData().phone"
          (input)="updateField('phone', $event)"
          placeholder="+1 (555) 123-4567"
        />
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="gender">Gender</label>
          <select 
            id="gender"
            [value]="formData().gender ?? ''"
            (change)="updateGender($event)"
          >
            <option value="">Select gender</option>
            <option value="male" [selected]="formData().gender === 'male'">Male</option>
            <option value="female" [selected]="formData().gender === 'female'">Female</option>
          </select>
        </div>
        <div class="form-group">
          <label for="yearLevel">Year Level</label>
          <select 
            id="yearLevel"
            [value]="formData().yearLevel ?? ''"
            (change)="updateYearLevel($event)"
          >
            <option value="">Select year</option>
            <option value="1" [selected]="formData().yearLevel === 1">1st Year</option>
            <option value="2" [selected]="formData().yearLevel === 2">2nd Year</option>
            <option value="3" [selected]="formData().yearLevel === 3">3rd Year</option>
            <option value="4" [selected]="formData().yearLevel === 4">4th Year</option>
            <option value="5" [selected]="formData().yearLevel === 5">5th Year</option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <label for="course">Course/Program</label>
        <input 
          type="text" 
          id="course"
          [value]="formData().course"
          (input)="updateField('course', $event)"
          placeholder="e.g. BS Computer Science"
        />
      </div>

      <div class="form-group">
        <label for="address">Home Address</label>
        <textarea 
          id="address"
          rows="2"
          [value]="formData().address"
          (input)="updateField('address', $event)"
          placeholder="Enter home address"
        ></textarea>
      </div>

      <div class="form-group">
        <label for="parent">Parent/Guardian</label>
        <select 
          id="parent"
          [value]="formData().parentId ?? ''"
          (change)="updateParent($event)"
        >
          <option value="">No parent assigned</option>
          @for (parent of parents; track parent.id) {
            <option [value]="parent.id" [selected]="formData().parentId === parent.id">
              {{ getParentFullName(parent) }} ({{ parent.email }})
            </option>
          }
        </select>
      </div>

      @if (mode === 'edit') {
        <div class="form-group">
          <label for="editPassword">New Password (leave blank to keep current)</label>
          <input 
            type="password" 
            id="editPassword"
            [value]="formData().password"
            (input)="updateField('password', $event)"
            placeholder="Enter new password"
          />
        </div>
      }
    </div>

    <div class="modal-footer">
      <button class="btn-secondary" (click)="close.emit()">Cancel</button>
      <button class="btn-primary" (click)="onSave()" [disabled]="isSaving">
        @if (isSaving) {
          Saving...
        } @else {
          {{ mode === 'add' ? 'Add Resident' : 'Save Changes' }}
        }
      </button>
    </div>
  </div>
</div>
